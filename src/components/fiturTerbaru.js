'use client';

import { useEffect, useRef, useState } from 'react';
import { Button, Box, useMediaQuery, useTheme, Typography } from '@mui/material';
import Tooltip, { tooltipClasses } from '@mui/material/Tooltip';
import { styled } from '@mui/material/styles';
import HomeRoundedIcon from '@mui/icons-material/HomeRounded';
import Link from 'next/link';

const CustomTooltip = styled(({ className, ...props }) => (
    <Tooltip
        {...props}
        classes={{ popper: className }}
        componentsProps={{
            tooltip: {
                sx: {
                    backgroundColor: 'transparent',
                    padding: 0,
                },
            },
        }}
        arrow={false}
    />
))(() => ({
    [`& .MuiTooltip-tooltip`]: {
        position: 'relative',
        backgroundColor: 'transparent',
    },
}));

export default function WhatsNew() {
    const theme = useTheme();
    const isMobile = useMediaQuery(theme.breakpoints.down("431"));
    const isMobileHeight = useMediaQuery("(max-height: 431px)");
    const isMobile768 = useMediaQuery("(max-width: 1024px)");
    const isMobileiPadAirLandscape = useMediaQuery("(width: 1180px) and (height: 820px)");
    const isMobileiPadAirPortrait = useMediaQuery("(height: 1180px) and (width: 820px)");
    const isMobileiPadProLandscape = useMediaQuery("(width: 1366px) and (height: 1024px)");
    const isMobileiPadProPortrait = useMediaQuery("(height: 1366px) and (width: 1024px)");
    const isMobileMD = useMediaQuery(theme.breakpoints.down("md"));

    const [hovered, setHovered] = useState(false);
    const [clicked, setClicked] = useState(false);
    const buttonRef = useRef(null);

    useEffect(() => {
        function handleClickOutside(event) {
            if (buttonRef.current && !buttonRef.current.contains(event.target)) {
                setClicked(false);
            }
        }

        // Tambahkan event listener saat tombol diklik
        document.addEventListener("mousedown", handleClickOutside);
        return () => {
            document.removeEventListener("mousedown", handleClickOutside);
        };
    }, []);

    return (
        <>
            {isMobile768 ||
                isMobileiPadAirLandscape ||
                isMobileiPadAirPortrait ||
                isMobileiPadProPortrait ||
                isMobileiPadProLandscape
                ? (
                    <Box ref={buttonRef}
                        sx={{
                            position: 'fixed',
                            bottom: "100px",
                            right: "0px",
                            boxShadow: "0px 15px 50px 0px rgba(0, 0, 0, 0.10)",
                        }}
                    >
                        <Button
                            disableElevation
                            variant="contained"
                            color="primary"
                            sx={{
                                borderRadius: "12px 0px 0px 12px",
                                display: 'flex',
                                alignItems: 'center',
                                gap: 1,
                                height: "42px",
                                minWidth: "48px",
                                width: clicked ? "280px" : "48px",
                                padding: "6px 16px",
                                transition: 'width 0.3s ease, opacity 0.3s ease',
                                background: "var(--jakartasatu-orange)",
                                textTransform: "none",
                                fontSize: "14px",
                                fontWeight: "600",
                                lineHeight: "150%",
                                justifyContent: 'flex-start',
                                overflow: 'hidden',

                                '&:hover': {
                                    background: 'var(--jakartasatu-orange)',
                                },
                            }}
                        >
                            <Box onClick={() => setClicked(prev => !prev)}
                                sx={{
                                    cursor: "pointer",
                                    transition: 'transform 0.3s ease',
                                }}>
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="26" viewBox="0 -3 29 29" fill="none">
                                    <g clipPath="url(#clip0_27813_2281)">
                                        <path d="M19.439 7.74953C19.0227 7.21217 18.4562 6.81054 17.8114 6.59557L16.1463 6.05424C16.0185 6.00874 15.9078 5.92479 15.8296 5.81391C15.7514 5.70303 15.7094 5.57066 15.7094 5.43497C15.7094 5.29928 15.7514 5.16691 15.8296 5.05603C15.9078 4.94516 16.0185 4.8612 16.1463 4.8157L17.8114 4.27437C18.3041 4.10422 18.7516 3.82406 19.1199 3.45515C19.4881 3.08624 19.7675 2.63829 19.9368 2.14528L19.9501 2.1042L20.4915 0.440325C20.5365 0.311654 20.6204 0.200156 20.7315 0.121267C20.8427 0.042378 20.9756 0 21.112 0C21.2483 0 21.3812 0.042378 21.4924 0.121267C21.6035 0.200156 21.6874 0.311654 21.7324 0.440325L22.2726 2.1042C22.4414 2.60994 22.7258 3.06938 23.1031 3.44608C23.4804 3.82278 23.9403 4.10637 24.4463 4.27437L26.1102 4.8157L26.1441 4.82416C26.2719 4.86966 26.3825 4.95361 26.4607 5.06449C26.539 5.17537 26.581 5.30774 26.581 5.44343C26.581 5.57912 26.539 5.71149 26.4607 5.82237C26.3825 5.93324 26.2719 6.0172 26.1441 6.0627L24.479 6.60403C23.9732 6.77219 23.5135 7.05586 23.1364 7.43255C22.7593 7.80924 22.4751 8.26859 22.3064 8.7742L21.7651 10.4381L21.7493 10.4792C21.6971 10.6007 21.6094 10.7037 21.4977 10.7747C21.386 10.8456 21.2555 10.8812 21.1233 10.8768C20.991 10.8723 20.8632 10.8281 20.7565 10.7498C20.6498 10.6715 20.5692 10.5629 20.5253 10.4381L19.984 8.7742C19.8631 8.40389 19.6791 8.05724 19.4402 7.74953M28.7383 12.3424L27.8128 12.0427C27.5319 11.9488 27.2767 11.7909 27.0674 11.5814C26.8582 11.3719 26.7005 11.1166 26.6068 10.8356L26.3048 9.91245C26.2797 9.84108 26.2332 9.77924 26.1715 9.73549C26.1098 9.69174 26.036 9.66824 25.9604 9.66824C25.8848 9.66824 25.811 9.69174 25.7493 9.73549C25.6876 9.77924 25.641 9.84108 25.616 9.91245L25.3163 10.8356C25.2244 11.1148 25.0693 11.3689 24.8631 11.5783C24.6569 11.7877 24.4051 11.9466 24.1273 12.0427L23.203 12.3424C23.1316 12.3674 23.0698 12.414 23.026 12.4757C22.9823 12.5374 22.9588 12.6112 22.9588 12.6868C22.9588 12.7624 22.9823 12.8362 23.026 12.8979C23.0698 12.9596 23.1316 13.0061 23.203 13.0312L24.1273 13.332C24.409 13.426 24.6649 13.5843 24.8747 13.7945C25.0845 14.0047 25.2423 14.2609 25.3357 14.5428L25.6353 15.466C25.6604 15.5373 25.7069 15.5992 25.7686 15.6429C25.8303 15.6867 25.9041 15.7102 25.9797 15.7102C26.0554 15.7102 26.1291 15.6867 26.1908 15.6429C26.2525 15.5992 26.2991 15.5373 26.3241 15.466L26.625 14.5428C26.7187 14.2617 26.8766 14.0063 27.0861 13.7968C27.2956 13.5873 27.551 13.4294 27.8321 13.3357L28.7565 13.036C28.8278 13.011 28.8897 12.9644 28.9334 12.9027C28.9772 12.841 29.0007 12.7672 29.0007 12.6916C29.0007 12.616 28.9772 12.5422 28.9334 12.4805C28.8897 12.4188 28.8278 12.3723 28.7565 12.3472L28.7383 12.3424ZM25.9302 16.9788C26.0808 16.9788 26.2182 16.9619 26.3422 16.928C25.2197 22.4405 20.3453 26.5875 14.5006 26.5875C7.82814 26.5875 2.41602 21.1765 2.41602 14.5029C2.41602 7.82808 7.82693 2.41716 14.5018 2.41716C15.6581 2.41716 16.7771 2.58028 17.8368 2.88357C17.695 2.96977 17.5452 3.03985 17.3873 3.09382L15.7681 3.62549C15.399 3.75412 15.0788 3.99398 14.8516 4.31207C14.6244 4.63016 14.5013 5.01085 14.4993 5.40174C14.5018 6.16903 15.002 6.94478 15.7077 7.25049L17.3993 7.80632C18.0228 8.01778 18.6246 8.49024 18.8373 9.12341L19.3327 10.8755C19.4583 11.2441 19.6958 11.5645 20.012 11.7919C20.3281 12.0193 20.7074 12.1424 21.0968 12.1442C21.382 12.1479 21.6648 12.0814 21.9185 11.9509C21.7761 12.1926 21.701 12.4679 21.701 12.7484C21.6962 13.4009 22.1384 14.0147 22.7523 14.2347C22.8417 14.262 22.94 14.2886 23.0471 14.3144C23.4821 14.4244 24.0017 14.5561 24.1418 14.9838L24.1588 15.0382C24.4439 15.9432 24.7702 16.9776 25.9302 16.9776M14.4993 12.6892C14.259 12.6892 14.0285 12.7847 13.8585 12.9546C13.6886 13.1246 13.5931 13.3551 13.5931 13.5955V19.6371C13.5931 19.8775 13.6886 20.108 13.8585 20.2779C14.0285 20.4479 14.259 20.5434 14.4993 20.5434C14.7397 20.5434 14.9702 20.4479 15.1402 20.2779C15.3101 20.108 15.4056 19.8775 15.4056 19.6371V13.5955C15.4056 13.3551 15.3101 13.1246 15.1402 12.9546C14.9702 12.7847 14.7397 12.6892 14.4993 12.6892ZM14.4993 10.8767C14.8198 10.8767 15.1272 10.7494 15.3538 10.5228C15.5804 10.2962 15.7077 9.98884 15.7077 9.66837C15.7077 9.3479 15.5804 9.04055 15.3538 8.81395C15.1272 8.58734 14.8198 8.46003 14.4993 8.46003C14.1789 8.46003 13.8715 8.58734 13.6449 8.81395C13.4183 9.04055 13.291 9.3479 13.291 9.66837C13.291 9.98884 13.4183 10.2962 13.6449 10.5228C13.8715 10.7494 14.1789 10.8767 14.4993 10.8767Z" fill="white" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_27813_2281">
                                            <rect width="29" height="29" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                            </Box>
                            {clicked && (
                                <Link href={`${process.env.BASE_URL}/fitur-terbaru`}>
                                    <Typography variant='p'
                                        sx={{
                                            transition: 'opacity 0.3s ease',
                                            opacity: 1,
                                            whiteSpace: 'nowrap',
                                            padding: "14px 35px",
                                            width: "100%",
                                            // marginRight: "-20px",

                                            color: "var(--jakartasatu-biru)",
                                            background: "white",
                                            fontSize: "14px",
                                            fontWeight: "600",
                                            lineHeight: "150%",
                                        }}
                                    >
                                        Lihat fitur terbaru disini
                                    </Typography>
                                </Link>
                            )}
                        </Button>
                    </Box>
                ) : (
                    <Box
                        sx={{
                            position: 'fixed',
                            top: "255px",
                            right: "0px",
                            boxShadow: "0px 15px 50px 0px rgba(0, 0, 0, 0.10)",
                        }}
                    >
                        <Link href={`${process.env.BASE_URL}/fitur-terbaru`}>
                            <Button
                                disableElevation
                                variant="contained"
                                color="primary"
                                onMouseEnter={() => setHovered(true)}
                                onMouseLeave={() => setHovered(false)}
                                sx={{
                                    borderRadius: "12px 0px 0px 12px",
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: 1,
                                    height: "42px",
                                    minWidth: "48px",
                                    width: hovered ? "280px" : "48px",
                                    padding: "6px 16px",
                                    transition: 'width 0.3s ease, opacity 0.3s ease',
                                    background: "var(--jakartasatu-orange)",
                                    textTransform: "none",
                                    fontSize: "14px",
                                    fontWeight: "600",
                                    lineHeight: "150%",
                                    justifyContent: 'flex-start',
                                    overflow: 'hidden',

                                    '&:hover': {
                                        background: 'var(--jakartasatu-orange)',
                                    },
                                }}
                            >
                                <Box sx={{
                                    transition: 'transform 0.3s ease',
                                    transform: hovered ? 'translateX(0)' : 'translateX(0)',
                                }}>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="26" viewBox="0 -3 29 29" fill="none">
                                        <g clipPath="url(#clip0_27813_2281)">
                                            <path d="M19.439 7.74953C19.0227 7.21217 18.4562 6.81054 17.8114 6.59557L16.1463 6.05424C16.0185 6.00874 15.9078 5.92479 15.8296 5.81391C15.7514 5.70303 15.7094 5.57066 15.7094 5.43497C15.7094 5.29928 15.7514 5.16691 15.8296 5.05603C15.9078 4.94516 16.0185 4.8612 16.1463 4.8157L17.8114 4.27437C18.3041 4.10422 18.7516 3.82406 19.1199 3.45515C19.4881 3.08624 19.7675 2.63829 19.9368 2.14528L19.9501 2.1042L20.4915 0.440325C20.5365 0.311654 20.6204 0.200156 20.7315 0.121267C20.8427 0.042378 20.9756 0 21.112 0C21.2483 0 21.3812 0.042378 21.4924 0.121267C21.6035 0.200156 21.6874 0.311654 21.7324 0.440325L22.2726 2.1042C22.4414 2.60994 22.7258 3.06938 23.1031 3.44608C23.4804 3.82278 23.9403 4.10637 24.4463 4.27437L26.1102 4.8157L26.1441 4.82416C26.2719 4.86966 26.3825 4.95361 26.4607 5.06449C26.539 5.17537 26.581 5.30774 26.581 5.44343C26.581 5.57912 26.539 5.71149 26.4607 5.82237C26.3825 5.93324 26.2719 6.0172 26.1441 6.0627L24.479 6.60403C23.9732 6.77219 23.5135 7.05586 23.1364 7.43255C22.7593 7.80924 22.4751 8.26859 22.3064 8.7742L21.7651 10.4381L21.7493 10.4792C21.6971 10.6007 21.6094 10.7037 21.4977 10.7747C21.386 10.8456 21.2555 10.8812 21.1233 10.8768C20.991 10.8723 20.8632 10.8281 20.7565 10.7498C20.6498 10.6715 20.5692 10.5629 20.5253 10.4381L19.984 8.7742C19.8631 8.40389 19.6791 8.05724 19.4402 7.74953M28.7383 12.3424L27.8128 12.0427C27.5319 11.9488 27.2767 11.7909 27.0674 11.5814C26.8582 11.3719 26.7005 11.1166 26.6068 10.8356L26.3048 9.91245C26.2797 9.84108 26.2332 9.77924 26.1715 9.73549C26.1098 9.69174 26.036 9.66824 25.9604 9.66824C25.8848 9.66824 25.811 9.69174 25.7493 9.73549C25.6876 9.77924 25.641 9.84108 25.616 9.91245L25.3163 10.8356C25.2244 11.1148 25.0693 11.3689 24.8631 11.5783C24.6569 11.7877 24.4051 11.9466 24.1273 12.0427L23.203 12.3424C23.1316 12.3674 23.0698 12.414 23.026 12.4757C22.9823 12.5374 22.9588 12.6112 22.9588 12.6868C22.9588 12.7624 22.9823 12.8362 23.026 12.8979C23.0698 12.9596 23.1316 13.0061 23.203 13.0312L24.1273 13.332C24.409 13.426 24.6649 13.5843 24.8747 13.7945C25.0845 14.0047 25.2423 14.2609 25.3357 14.5428L25.6353 15.466C25.6604 15.5373 25.7069 15.5992 25.7686 15.6429C25.8303 15.6867 25.9041 15.7102 25.9797 15.7102C26.0554 15.7102 26.1291 15.6867 26.1908 15.6429C26.2525 15.5992 26.2991 15.5373 26.3241 15.466L26.625 14.5428C26.7187 14.2617 26.8766 14.0063 27.0861 13.7968C27.2956 13.5873 27.551 13.4294 27.8321 13.3357L28.7565 13.036C28.8278 13.011 28.8897 12.9644 28.9334 12.9027C28.9772 12.841 29.0007 12.7672 29.0007 12.6916C29.0007 12.616 28.9772 12.5422 28.9334 12.4805C28.8897 12.4188 28.8278 12.3723 28.7565 12.3472L28.7383 12.3424ZM25.9302 16.9788C26.0808 16.9788 26.2182 16.9619 26.3422 16.928C25.2197 22.4405 20.3453 26.5875 14.5006 26.5875C7.82814 26.5875 2.41602 21.1765 2.41602 14.5029C2.41602 7.82808 7.82693 2.41716 14.5018 2.41716C15.6581 2.41716 16.7771 2.58028 17.8368 2.88357C17.695 2.96977 17.5452 3.03985 17.3873 3.09382L15.7681 3.62549C15.399 3.75412 15.0788 3.99398 14.8516 4.31207C14.6244 4.63016 14.5013 5.01085 14.4993 5.40174C14.5018 6.16903 15.002 6.94478 15.7077 7.25049L17.3993 7.80632C18.0228 8.01778 18.6246 8.49024 18.8373 9.12341L19.3327 10.8755C19.4583 11.2441 19.6958 11.5645 20.012 11.7919C20.3281 12.0193 20.7074 12.1424 21.0968 12.1442C21.382 12.1479 21.6648 12.0814 21.9185 11.9509C21.7761 12.1926 21.701 12.4679 21.701 12.7484C21.6962 13.4009 22.1384 14.0147 22.7523 14.2347C22.8417 14.262 22.94 14.2886 23.0471 14.3144C23.4821 14.4244 24.0017 14.5561 24.1418 14.9838L24.1588 15.0382C24.4439 15.9432 24.7702 16.9776 25.9302 16.9776M14.4993 12.6892C14.259 12.6892 14.0285 12.7847 13.8585 12.9546C13.6886 13.1246 13.5931 13.3551 13.5931 13.5955V19.6371C13.5931 19.8775 13.6886 20.108 13.8585 20.2779C14.0285 20.4479 14.259 20.5434 14.4993 20.5434C14.7397 20.5434 14.9702 20.4479 15.1402 20.2779C15.3101 20.108 15.4056 19.8775 15.4056 19.6371V13.5955C15.4056 13.3551 15.3101 13.1246 15.1402 12.9546C14.9702 12.7847 14.7397 12.6892 14.4993 12.6892ZM14.4993 10.8767C14.8198 10.8767 15.1272 10.7494 15.3538 10.5228C15.5804 10.2962 15.7077 9.98884 15.7077 9.66837C15.7077 9.3479 15.5804 9.04055 15.3538 8.81395C15.1272 8.58734 14.8198 8.46003 14.4993 8.46003C14.1789 8.46003 13.8715 8.58734 13.6449 8.81395C13.4183 9.04055 13.291 9.3479 13.291 9.66837C13.291 9.98884 13.4183 10.2962 13.6449 10.5228C13.8715 10.7494 14.1789 10.8767 14.4993 10.8767Z" fill="white" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_27813_2281">
                                                <rect width="29" height="29" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </Box>
                                <Typography variant='p'
                                    sx={{
                                        transition: 'opacity 0.3s ease',
                                        opacity: 1,
                                        whiteSpace: 'nowrap',
                                        padding: "14px 10px",
                                        width: "100%",
                                        marginRight: "-20px",

                                        color: "var(--jakartasatu-biru)",
                                        background: "white",
                                        fontSize: "14px",
                                        fontWeight: "600",
                                        lineHeight: "150%",
                                    }}
                                >
                                    Lihat fitur terbaru disini
                                </Typography>
                            </Button>
                        </Link>
                    </Box>
                )
            }
        </>
    );
}
